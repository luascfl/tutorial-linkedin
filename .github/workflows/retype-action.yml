name: Publish Retype powered website to GitHub Pages
on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  publish:
    name: Publish to retype branch
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: 'true'

      - name: Initialize submodules
        run: git submodule update --init --recursive

      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '7.0.x'

      - name: Build with Retype
        uses: retypeapp/action-build@latest
        with:
          license: ${{ secrets.RETYPE_LICENSE_KEY }}
          # Specify a fixed output directory
          args: --output ./retype-dist

      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: retype
          # Reference the fixed output directory
          folder: ./retype-dist
          clean: true
          force: true